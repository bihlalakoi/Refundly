<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verify Email - Refundly Pay</title>
    <link rel="stylesheet" href="css/design-system.css">
    <link rel="stylesheet" href="css/components-v2.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body style="background: var(--color-slate-50); min-height: 100vh; display: grid; place-items: center; padding: 24px;">
    <div class="card" style="max-width: 560px; width: 100%; text-align: center;">
        <div
            style="width: 64px; height: 64px; border-radius: 50%; background: #ecfdf5; color: #16a34a; margin: 0 auto 20px; display: flex; align-items: center; justify-content: center;">
            <i class="fas fa-envelope-open-text" style="font-size: 28px;"></i>
        </div>

        <h1 style="margin-bottom: 12px;">Check your email</h1>
        <p style="color: var(--color-slate-600); margin-bottom: 20px;">
            We've sent a verification link to <strong id="emailText">your email</strong>.
            Click the link to activate your account.
        </p>

        <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
            <button id="resendBtn" class="btn btn-primary">Resend Verification Email</button>
            <a href="/login.html" class="btn btn-secondary">Back to Login</a>
        </div>

        <p id="statusText" style="margin-top: 16px; color: var(--color-slate-500); font-size: 0.9rem;"></p>
    </div>

    <script src="js/utils.js"></script>
    <script>
        const params = new URLSearchParams(window.location.search);
        const email = params.get('email') || '';
        const emailText = document.getElementById('emailText');
        const resendBtn = document.getElementById('resendBtn');
        const statusText = document.getElementById('statusText');

        if (email) {
            emailText.textContent = email;
        } else {
            emailText.textContent = 'your inbox';
            resendBtn.disabled = true;
            statusText.textContent = 'Email not provided. Please register again.';
        }

        resendBtn.addEventListener('click', async () => {
            if (!email) return;
            const originalText = resendBtn.innerHTML;
            resendBtn.disabled = true;
            resendBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';
            statusText.textContent = '';

            try {
                const response = await fetch('/api/resend-verification', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email })
                });
                const result = await response.json();
                if (result.success) {
                    Toast.success(result.message || 'Verification email sent.');
                    statusText.textContent = 'Verification email sent. Please check your inbox.';
                } else {
                    Toast.error(result.message || 'Failed to resend verification email.');
                    statusText.textContent = result.message || 'Failed to resend verification email.';
                }
            } catch (error) {
                Toast.error('Unable to resend verification email right now.');
                statusText.textContent = 'Unable to resend verification email right now.';
            } finally {
                resendBtn.disabled = false;
                resendBtn.innerHTML = originalText;
            }
        });
    </script>
</body>

</html>
